services:
  sabnzbd:
    image: lscr.io/linuxserver/sabnzbd:4.3.2
    container_name: sabnzbd
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      - /mnt/user/appdata/sabnzbd:/config
      - /mnt/user/data:/data
    # Optional: remove if ONLY accessing via Traefik
    ports:
      - "8080:8080"

    networks:
      - media_net
      - proxy_net

    labels:
      # -----------------------------------
      # Traefik
      # -----------------------------------
      - traefik.enable=true
      - traefik.docker.network=proxy_net

      - traefik.http.routers.sabnzbd.rule=Host(`sabnzbd.theblaskies.com`)
      - traefik.http.routers.sabnzbd.entrypoints=websecure
      - traefik.http.routers.sabnzbd.tls=true
      - traefik.http.routers.sabnzbd.tls.certresolver=cloudflare

      - traefik.http.services.sabnzbd.loadbalancer.server.port=8080

      # -----------------------------------
      # OAuth / Forward Auth (disabled for now)
      # -----------------------------------
      # - traefik.http.routers.sabnzbd.middlewares=oauth@file
      # - traefik.http.middlewares.oauth.forwardauth.address=https://auth.theblaskies.com/outpost.goauthentik.io/auth/traefik
      # - traefik.http.middlewares.oauth.forwardauth.trustForwardHeader=true
      # - traefik.http.middlewares.oauth.forwardauth.authResponseHeaders=X-authentik-username,X-authentik-groups

networks:
  media_net:
    external: true

  proxy_net:
    external: true
